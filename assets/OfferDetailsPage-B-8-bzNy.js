import{e as b,f as p,d as g,b as h,c as x,j as e,L as t}from"./index-BLSWsbFh.js";import{u as j}from"./useTitle-CnsTpNOj.js";import N from"./NotFoundPage-Bz87DV-4.js";import{M as v,T as I,b as y}from"./TileLayer-Bi_vTqq1.js";function O(){const{offerId:l}=b(),n=p(),{user:o,isAuthenticated:r}=g(),{getOfferById:a,claimOffer:i}=h(),{addToast:c}=x(),s=a(l);if(j(s?s.title:"Загрузка..."),!s)return e.jsx(N,{});const d=()=>{i(s.id),c("Запрос успешно отправлен организации!"),n("/map")},u=()=>{if(console.log("--- Проверка renderClaimButton ---"),console.log("1. Залогинен ли? (isAuthenticated):",r),console.log("2. Кто пользователь? (user):",o),console.log("3. ID пользователя (user.id):",o?o.id:"N/A"),console.log("4. ID владельца объявления (offer.userId):",s.userId),console.log("5. Роль пользователя (user.role):",o?o.role:"N/A"),console.log("6. Статус объявления (offer.status):",s.status),!r)return console.log("-> РЕШЕНИЕ: Пользователь не залогинен. Ничего не показываем."),null;if(o.role==="volunteer")switch(console.log("-> РЕШЕНИЕ: Пользователь - Волонтер."),s.status){case"Active":return e.jsx("button",{onClick:d,className:"btn btn-primary btn-claim",children:"Забрать"});case"Reserved":return e.jsx("button",{className:"btn btn-secondary btn-claim",disabled:!0,children:"Ожидает подтверждения"});case"Confirmed":return e.jsx("button",{className:"btn btn-success btn-claim",disabled:!0,children:"Подтверждено"});default:return null}return o.role==="organization"?(console.log("-> РЕШЕНИЕ: Пользователь - Организация."),s.userId===o.id?(console.log("-> ...и это ЕГО объявление."),e.jsx(t,{to:"/dashboard",className:"btn btn-secondary btn-claim",children:"Управление в дашборде"})):(console.log("-> ...но это ЧУЖОЕ объявление."),e.jsx("button",{className:"btn btn-secondary btn-claim",disabled:!0,children:"Только для волонтеров"}))):(console.log("-> РЕШЕНИЕ: Не подошло ни одно из условий. Ничего не показываем."),null)};return e.jsxs("div",{className:"offer-details-container",children:[e.jsxs("div",{className:"offer-details-media",children:[e.jsx("img",{src:s.imageUrl,alt:s.title}),e.jsxs(v,{center:s.position,zoom:15,className:"offer-details-map",children:[e.jsx(I,{url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",attribution:"Tiles © Esri"}),e.jsx(y,{position:s.position})]})]}),e.jsxs("div",{className:"offer-details-info",children:[e.jsx("h1",{className:"offer-title",children:s.title}),e.jsxs("p",{className:"offer-meta",children:["от ",e.jsx(t,{to:`/profile/${s.userId}`,children:s.location})]}),e.jsx("p",{className:"offer-description",children:s.description}),e.jsx("ul",{className:"offer-specs",children:s.specs&&s.specs.map((f,m)=>e.jsx("li",{children:f},m))}),u()]})]})}export{O as default};
