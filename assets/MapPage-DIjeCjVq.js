import{r as i,b as y,j as e,L as v}from"./index-BLSWsbFh.js";import{u as b,c as C,l as S,a as M,M as w,T as N,b as P}from"./TileLayer-Bi_vTqq1.js";import{u as L}from"./useTitle-CnsTpNOj.js";function T(){return b().map}const E=C(function(r,s){const n=new S.Popup(r,s.overlayContainer);return M(n,s)},function(r,s,{position:n},o){i.useEffect(function(){const{instance:t}=r;function l(c){c.popup===t&&(t.update(),o(!0))}function u(c){c.popup===t&&o(!1)}return s.map.on({popupopen:l,popupclose:u}),s.overlayContainer==null?(n!=null&&t.setLatLng(n),t.openOn(s.map)):s.overlayContainer.bindPopup(t),function(){s.map.off({popupopen:l,popupclose:u}),s.overlayContainer?.unbindPopup(),s.map.removeLayer(t)}},[r,s,o,n])});function F({searchLocation:a}){const r=T();return i.useEffect(()=>{a&&r.flyTo([a.lat,a.lng],14,{animate:!0,duration:1.5})},[a,r]),null}function O({searchLocation:a,category:r,searchTerm:s}){const{offers:n}=y(),o={lat:49.2331,lon:28.4682},d=i.useMemo(()=>{const t=s.toLowerCase();return n.filter(l=>!(!(r==="all"||l.category&&l.category.toLowerCase()===r)||!(!t||l.title.toLowerCase().includes(t))))},[n,r,s]);return e.jsxs(w,{center:[o.lat,o.lon],zoom:13,className:"map-container",children:[e.jsx(N,{url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"}),d.map(t=>e.jsx(P,{position:t.position,children:e.jsx(E,{children:e.jsxs("div",{className:"popup-content",children:[e.jsx("img",{src:t.imageUrl,alt:t.title}),e.jsx("h3",{children:t.title}),e.jsx("p",{children:t.location}),e.jsx(v,{to:`/offer/${t.id}`,className:"btn btn-primary",children:"Детали"})]})})},t.id)),e.jsx(F,{searchLocation:a})]})}function k(a,r){const[s,n]=i.useState(a);return i.useEffect(()=>{const o=setTimeout(()=>{n(a)},r);return()=>{clearTimeout(o)}},[a,r]),s}function W(){L("Карта объявлений");const[a,r]=i.useState("all"),[s,n]=i.useState(null),[o,d]=i.useState(""),t=k(o,500),[l,u]=i.useState(window.innerWidth>768),[c,f]=i.useState(""),j=async p=>{if(p.preventDefault(),!c){n(null);return}try{const h=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(c)}`)).json();if(h&&h.length>0){const{lat:x,lon:g}=h[0];n({lat:parseFloat(x),lng:parseFloat(g)}),window.innerWidth<=768&&u(!1)}else alert("Адрес не найден.")}catch(m){console.error("Ошибка при поиске адреса:",m),alert("Произошла ошибка при поиске.")}};return e.jsxs("div",{className:"map-page-container",children:[e.jsx("button",{className:"filter-toggle btn btn-secondary",onClick:()=>u(!l),children:l?"✖":"☰"}),e.jsxs("aside",{className:`filters-panel ${l?"open":""}`,children:[e.jsx("div",{className:"filters-header",children:e.jsx("h2",{children:"Фильтры"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{htmlFor:"search",children:"Поиск по названию"}),e.jsx("input",{type:"text",id:"search",placeholder:"Например, 'хлеб' или 'овощи'",value:o,onChange:p=>d(p.target.value)})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{htmlFor:"address",children:"Поиск по адресу"}),e.jsxs("form",{onSubmit:j,style:{display:"flex",gap:"0.5rem"},children:[e.jsx("input",{type:"text",id:"address",placeholder:"Введите адрес",value:c,onChange:p=>f(p.target.value)}),e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Найти"})]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{htmlFor:"category",children:"Категория"}),e.jsxs("select",{id:"category",value:a,onChange:p=>r(p.target.value),children:[e.jsx("option",{value:"all",children:"Все"}),e.jsx("option",{value:"bakery",children:"Выпечка"}),e.jsx("option",{value:"produce",children:"Овощи и фрукты"}),e.jsx("option",{value:"dairy",children:"Молочные продукты"})]})]})]})]}),e.jsx(O,{searchLocation:s,category:a,searchTerm:t})]})}export{W as default};
